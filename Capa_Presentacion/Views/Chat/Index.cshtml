@{
    ViewBag.Title = "Index";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <title>Veterinaria Manatí</title>
    <!-- Boxiocns CDN Link -->
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="~/css/style_menu.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.2/assets/css/docs.css" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    <style>

        #header {
            padding: 20px;
            background-color: #d7e5e4;
            border-bottom: #5f9482 solid 2px;
            color: #1e4638;
            font-size: 24px;
        }

        .submitButton {
            background-color: #d7e5e4;
            border: #5f9482 solid 1px;
            padding: 4px;
            cursor: pointer;
        }

            .submitButton:hover {
                background-color: #e1e1e1;
            }

        .login {
            width: 250px;
            margin-left: auto;
            margin-right: auto;
            padding: 10px;
            border: solid 2px #5f9482;
            color: #1e4638;
        }

            .login .textBox {
                width: 240px;
            }


            .login #divButton {
                padding: 4px;
                text-align: right;
            }

        .chatRoom {
            width: 650px;
            margin-left: auto;
            margin-right: auto;
            border: solid 1px gray;
        }

            .chatRoom .title {
                font-size: 16px;
                font-weight: bold;
                padding: 8px;
                background-color: #d7e5e4;
                border-bottom: solid 1px #5f9482;
            }

            .chatRoom .content {
                height: 300px;
                clear: both;
            }

                .chatRoom .content .chatWindow {
                    float: left;
                    width: 409px;
                    height: 300px;
                    border-right: solid 1px #5f9482;
                    overflow-y: scroll;
                }

                    .chatRoom .content .chatWindow .message {
                        padding: 4px;
                    }

                        .chatRoom .content .chatWindow .message .userName {
                            font-weight: bold;
                        }

                .chatRoom .content .users {
                    float: right;
                    width: 240px;
                    height: 300px;
                }

                    .chatRoom .content .users .user {
                        display: block;
                        cursor: pointer;
                        padding: 4px;
                        background-color: #f9f9f9;
                        border-bottom: solid 1px #5f9482;
                    }

                    .chatRoom .content .users .loginUser {
                        display: block;
                        padding: 4px;
                        color: gray;
                        border-bottom: solid 1px #5f9482;
                    }

                    .chatRoom .content .users .user:hover {
                        background-color: #e1e1e1;
                    }

            .chatRoom .messageBar {
                border-top: solid 1px gray;
                padding: 4px;
            }

                .chatRoom .messageBar .textbox {
                    width: 550px;
                }

        .disconnect {
            position: absolute;
            margin: 10px;
            background-color: #ffcbcb;
            padding: 4px;
            border: solid 1px red;
        }


        .draggable {
            position: absolute;
            border: #5f9482 solid 1px !important;
            width: 250px;
        }

            .draggable .header {
                cursor: move;
                background-color: #d7e5e4;
                border-bottom: #5f9482 solid 1px;
                color: #1e4638;
            }

            .draggable .selText {
                color: black;
                padding: 4px;
            }

            .draggable .messageArea {
                width: 250px;
                overflow-y: scroll;
                height: 200px;
                border-bottom: #5f9482 solid 1px;
            }

                .draggable .messageArea .message {
                    padding: 4px;
                }

            .draggable .buttonBar {
                width: 250px;
                padding: 4px;
            }

                .draggable .buttonBar .msgText {
                    width: 172px;
                }

                .draggable .buttonBar .button {
                    margin-left: 4px;
                    width: 55px;
                }

        .p-2:hover {
            background-color: #7688AB;
            cursor: pointer;
        }

        #btnSendMessage:hover {
            color: #7688AB;
            cursor: pointer;
        }
    </style>
    <div class="sidebar close">
        <div class="logo-details">
            <i class='bx bxs-dog'></i>
            <span class="logo_name">Veterinaria</span>
        </div>
        @if (User.Identity.IsAuthenticated)
        {

            if (Session["Rol"].ToString() == "1" && Session["Rol"].ToString() != null)
            {
                <ul class="nav-links">
                    <li>
                        <a href="/Home">
                            <i class='bx bx-home'></i>
                            <span class="link_name">Home</span>
                        </a>
                        <ul class="sub-menu blank">
                            <li><a class="link_name" href="/Home">Home</a></li>
                        </ul>
                    </li>
                    <li>
                        <div class="iocn-link">
                            <a href="#">
                                <i class='bx bxs-calendar'></i>
                                <span class="link_name">Cita</span>
                            </a>
                            <i class='bx bxs-chevron-down arrow'></i>
                        </div>
                        <ul class="sub-menu">
                            <li><a href="/Cita/Citas">Ver Citas</a></li>
                            <li><a href="/Cita_Usuario/">Ver Cita-Usuarios</a></li>
                            <li><a href="/Cita/">Procesar Citas</a></li>
                        </ul>
                    </li>
                    <li>
                        <div class="iocn-link">
                            <a href="#">
                                <i class='bx bxs-dog'></i>
                                <span class="link_name">Mascota</span>
                            </a>
                            <i class='bx bxs-chevron-down arrow'></i>
                        </div>
                        <ul class="sub-menu">
                            <li><a href="/Mascota/Mascotas">Ver Mascotas</a></li>
                            <li><a href="/Mascota_Usuario/">Ver Mascota-Usuarios</a></li>
                            <li><a href="/RazaMascota/Razas">Ver Raza de Mascotas</a></li>
                            <li><a href="/TipoMascota/Tipos">Ver Tipo de Mascotas</a></li>
                            <li><a href="/Consejo/Consejos">Ver Consejos</a></li>
                            <li><a href="/Servicio/Servicios">Ver Servicios</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="/Chat/">
                            <i class='bx bxs-user-circle'></i>
                            <span class="link_name">Chat</span>
                        </a>
                        <ul class="sub-menu blank">
                            <li><a class="link_name" href="/Chat/">Chat</a></li>
                        </ul>
                    </li>
                    <li>
                        <div class="iocn-link">
                            <a href="#">
                                <i class='bx bxs-user-account'></i>
                                <span class="link_name">Cuenta</span>
                            </a>
                            <i class='bx bxs-chevron-down arrow'></i>
                        </div>
                        <ul class="sub-menu">
                            <li><a href="/Account/Perfil">Perfil</a></li>
                            <li><a href="/Account/Usuarios">Usuarios</a></li>
                            <li><a href="/Admin/Admins">Administración</a></li>
                            <li><a href="/Rol_Usuario/">Rol de Usuarios</a></li>
                        </ul>
                    </li>

                    <li>
                        <div class="profile-details">
                            <div class="profile-content">
                                <!--<img src="image/profile.jpg" alt="profileImg">-->
                            </div>
                            <div class="name-job">
                                <div class="profile_name" id="name"></div>
                                <div class="job" id="rol"></div>
                            </div>
                            <a href="/Account/Logout">
                                <i class='bx bx-log-out'></i>
                            </a>
                        </div>
                    </li>
                </ul>
            }
            else if (Session["Rol"].ToString() == "2" && Session["Rol"].ToString() != null)
            {
                <ul class="nav-links">
                    <li>
                        <a href="/Home">
                            <i class='bx bx-home'></i>
                            <span class="link_name">Home</span>
                        </a>
                        <ul class="sub-menu blank">
                            <li><a class="link_name" href="/Home">Home</a></li>
                        </ul>
                    </li>
                    <li>
                        <div class="iocn-link">
                            <a href="#">
                                <i class='bx bxs-calendar'></i>
                                <span class="link_name">Cita</span>
                            </a>
                            <i class='bx bxs-chevron-down arrow'></i>
                        </div>
                        <ul class="sub-menu">
                            <li><a href="/Cita/Create">Gestionar Cita</a></li>
                            <li><a href="/Cita/">Ver Cita</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="/Mascota/Create">
                            <i class='bx bxs-dog'></i>
                            <span class="link_name">Mascota</span>
                        </a>
                        <ul class="sub-menu blank">
                            <li><a class="link_name" href="/Mascota/Create">Mascota</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="/Chat/">
                            <i class='bx bxs-user-circle'></i>
                            <span class="link_name">Chat</span>
                        </a>
                        <ul class="sub-menu blank">
                            <li><a class="link_name" href="/Chat/">Chat</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="/Account/Perfil">
                            <i class='bx bxs-user-account'></i>
                            <span class="link_name">Perfil</span>
                        </a>
                        <ul class="sub-menu blank">
                            <li><a class="link_name" href="/Account/Perfil">Perfil</a></li>
                        </ul>
                    </li>

                    <li>
                        <div class="profile-details">
                            <div class="profile-content">
                                <!--<img src="image/profile.jpg" alt="profileImg">-->
                            </div>
                            <div class="name-job">
                                <div class="profile_name" id="name"></div>
                                <div class="job" id="rol"></div>
                            </div>
                            <a href="/Account/Logout">
                                <i class='bx bx-log-out'></i>
                            </a>
                        </div>
                    </li>
                </ul>
            }
        }
        else
        {
            <ul class="nav-links">
                <li>
                    <a href="/Home">
                        <i class='bx bx-home'></i>
                        <span class="link_name">Home</span>
                    </a>
                    <ul class="sub-menu blank">
                        <li><a class="link_name" href="/Home">Home</a></li>
                    </ul>
                </li>
                <li>
                    <a href="/Home">
                        <i class='bx bxs-calendar'></i>
                        <span class="link_name">Cita</span>
                    </a>
                    <ul class="sub-menu blank">
                        <li><a class="link_name" href="/Cita/Create">Cita</a></li>
                    </ul>
                </li>
                <li>
                    <a href="/Home">
                        <i class='bx bxs-dog'></i>
                        <span class="link_name">Mascota</span>
                    </a>
                    <ul class="sub-menu blank">
                        <li><a class="link_name" href="/Mascota/Create">Mascota</a></li>
                    </ul>
                </li>
                <li>
                    <a href="/Home">
                        <i class='bx bxs-user-circle'></i>
                        <span class="link_name">Chat</span>
                    </a>
                    <ul class="sub-menu blank">
                        <li><a class="link_name" href="/Chat/">Chat</a></li>
                    </ul>
                </li>
                <li>
                    <div class="iocn-link">
                        <a href="#">
                            <i class='bx bxs-user-account'></i>
                            <span class="link_name">Cuenta</span>
                        </a>
                        <i class='bx bxs-chevron-down arrow'></i>
                    </div>
                    <ul class="sub-menu">
                        <li><a href="/Account/Login">Iniciar Sesión</a></li>
                        <li><a href="/Account/Create">Registrarse</a></li>
                    </ul>
                </li>

            </ul>
        }
    </div>
    <section class="home-section">
        <div class="home-content">
            <i class='bx bx-menu'></i>
            <div class="container" style="margin-top: 580px">
                <div class="row vh-100 m-0 justify-content-center align-items-center">
                    <div class="col-md-12 col-auto">
                        @Html.Partial("_Notifications")
                        <section style="border-radius: 15px; " id="section">
                            <div class="container py-5">

                                <div class="row">
                                    <div class="col-md-12">

                                        <div class="card" id="chat3" style="border-radius: 15px; background-color: #7688AB">
                                            <div class="card-body">

                                                <div class="row" id="row">
                                                    <div class="col-md-6 col-lg-5 col-xl-4 mb-4 mb-md-0" style="background-color: #3e5f8a; border-radius: 15px;">

                                                        <div class="p-3">

                                                            <div class="overflow-auto" id="overflow" style="position: relative; height: 400px">
                                                                <ul class="list-unstyled mb-1" id="row2">
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <input id="txtNickName" type="text" class="textBox" style="display: none" />
                        <input id="hdId" type="text" style="display: none" />
                        <input id="hdUserName" type="text" style="display: none" />
                        @*<h2 style="text-align: center">Crear Cita</h2>
                            @using (Html.BeginForm())
                            {
                                @Html.AntiForgeryToken()

                                <div class="form-horizontal">
                                    <hr />
                                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                                    <section style="background-color: #11101d; border-radius: 15px; " id="section">
                                        <div class="container py-5">

                                            <div class="row">
                                                <div class="col-md-12">

                                                    <div class="card" id="chat3" style="border-radius: 15px;">
                                                        <div class="card-body">

                                                            <div class="row" id="row">
                                                                <div class="col-md-6 col-lg-5 col-xl-4 mb-4 mb-md-0" style="border-right: 1px solid #11101d;">

                                                                    <div class="p-3">

                                                                        <div class="overflow-auto" id="overflow" style="position: relative; height: 400px">
                                                                            <ul class="list-unstyled mb-0" id="row2">
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                    <input id="txtNickName" type="text" class="textBox" style="display: none" />
                                    <input id="hdId" type="text" style="display: none" />
                                    <input id="hdUserName" type="text" style="display: none" />
                                </div>
                                            }*@
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js" integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.js"></script>
    <script src="https://kit.fontawesome.com/2f21f67d01.js" crossorigin="anonymous"></script>
    <script src="~/Scripts/jquery.signalR-2.4.3.min.js"></script>
    <script src="http://www.codeproject.com/signalr/hubs"></script>
    <script src="~/signalr/hubs"></script>

    <script>

        let nombreUsuarios = [];

        $(document).ready(function () {
            listarNombreUsuario2();
            listarNombreUsuario();
            obtenerRolUsuario();
        });

        //$(function () {

        //    setScreen(true);

        //    // Declare a proxy to reference the hub.
        //    var chatHub = $.connection.chatHub;

        //    registerClientMethods(chatHub);

        //    // Start Hub
        //    $.connection.hub.start().done(function () {

        //        registerEvents(chatHub);

        //    });

        //});

        function listarNombreUsuario2() {

            $.ajax({
                type: "GET",
                url: "/Account/listarid_UsuarioPorEmail",
                dataType: "JSON",
                contentType: "application/json; charset=utf-8",
                cache: false,

                success: function (data) {

                    $.ajax({
                        type: "POST",
                        url: "/Account/listarNombre_CompletoPorid_Usuario",
                        traditional: true,
                        data: { "id": data },

                        success: function (data) {

                            $("#txtNickName").val(data);
                            setScreen(true);

                            // Declare a proxy to reference the hub.
                            var chatHub = $.connection.chatHub;

                            registerClientMethods(chatHub);

                            // Start Hub
                            $.connection.hub.start().done(function () {

                                registerEvents(chatHub);

                            });
                        },

                        error: function (error) {
                            alert("Ha ocurrido un error: " + error);
                        }

                    });

                },

                error: function (error) {
                    alert("Ha ocurrido un error: " + error);
                }
            });

        }

        function setScreen(isLogin) {

            if (!isLogin) {

                $("#divChat").hide();
                $("#divLogin").show();
            }
            else {

                $("#divChat").show();
                $("#divLogin").hide();
            }

        }

        function registerEvents(chatHub) {

            var name = $("#txtNickName").val();
            chatHub.server.connect(name);
            $("#btnStartChat").click(function () {

                //var name = $("#txtNickName").val();
                //if (name.length > 0) {
                //    chatHub.server.connect(name);
                //}
                //else {
                //    alert("Please enter name");
                //}

            });


            $('#btnSendMsg').click(function () {

                var msg = $("#txtMessage").val();
                if (msg.length > 0) {

                    var userName = $('#hdUserName').val();
                    chatHub.server.sendMessageToAll(userName, msg);
                    $("#txtMessage").val('');
                }
            });


            $("#txtMessage").keypress(function (e) {
                if (e.which == 13) {
                    $('#btnSendMsg').click();
                }
            });


        }

        function registerClientMethods(chatHub) {

            // Calls when user successfully logged in
            chatHub.client.onConnected = function (id, userName, allUsers, messages) {

                setScreen(true);

                $('#hdId').val(id);
                $('#hdUserName').val(userName);
                $('#spanUser').html(userName);

                // Add All Users
                for (i = 0; i < allUsers.length; i++) {

                    AddUser(chatHub, allUsers[i].ConnectionId, allUsers[i].UserName);
                }

                // Add Existing Messages
                for (i = 0; i < messages.length; i++) {

                    AddMessage(messages[i].UserName, messages[i].Message);
                }


            }

            // On New User Connected
            chatHub.client.onNewUserConnected = function (id, name) {

                AddUser(chatHub, id, name);
            }


            // On User Disconnected
            chatHub.client.onUserDisconnected = function (id, userName) {

                $('#' + id).remove();

                var ctrId = 'private_' + id;
                $('#' + ctrId).remove();


                var disc = $('<div class="disconnect">"' + userName + '" logged off.</div>');


                //$(disc).hide();
                //$('#' + id).prepend(disc);
                //$(disc).fadeIn(200).delay(2000).fadeOut(200);

            }

            chatHub.client.messageReceived = function (userName, message) {

                AddMessage(userName, message);
            }

            var nombre = [];
            chatHub.client.sendPrivateMessage = function (windowId, fromUserName, message) {

                var ctrId = 'private_' + windowId;
                var userId = $('#hdId').val();

                if ($('#' + ctrId).length == 0) {

                    createPrivateChatWindow(chatHub, windowId, ctrId, fromUserName);

                }
                var chkAsientos = document.getElementsByClassName("content")

                for (let i = 0; i < chkAsientos.length; i++) {
                    if (chkAsientos[i] == fromUserName) {
                        alert("Si");
                    }
                }
                nombreUsuarios.push(fromUserName);
                var userId = $('#hdId').val();

                const date = new Date();

                for (let i = 0; i < nombreUsuarios.length; i++) {
                    if (nombreUsuarios[i] == fromUserName) {

                        $('#contenido').append("<div class='d-flex flex-row justify-content-start content' id='" + fromUserName + "'>" +
                            "           <img src='/Account/getImagePorNombre?nombre=" + fromUserName + "' class='rounded' alt='avatar 1' style='width: 55px; height: 100%;'/>" +
                            "           <div id='divMessage'>" +
                            "<p class='small p-2 ms-3 mb-1 rounded-3' style='background-color: #f5f6f7; '>" + fromUserName + " : " + message + "</p>" +
                            "<p class='small ms-3 mb-3 rounded-3 float-end' style='color: #F5F6F7'>" + date.toLocaleDateString() + " | " + date.toLocaleTimeString('en-ES') + "</p>" +
                            "           </div>" +
                            "       </div>"
                        );
                        break;

                    } else {
                        $('#contenido').append("<div class='d-flex flex-row justify-content-end content' id='" + fromUserName + "'>" +
                            "           <div id='divMessage'>" +
                            "<p class='small p-2 me-3 mb-1 text-white rounded-3' style='background-color: #3e5f8a;'>" + fromUserName + " : " + message + "</p>" +
                            "<p class='small ms-3 mb-3 rounded-3' style='color: #F5F6F7'>" + date.toLocaleDateString() + " | " + date.toLocaleTimeString('en-US') + "</p>" +
                            "           </div>" +
                            "           <img src='/Account/getImagePorNombre?nombre=" + fromUserName + "' class='rounded' alt='avatar 1' style='width: 55px; height: 100%;'/>" +

                            "       </div>"
                        );
                        break;

                    }
                }

                // set scrollbar
                //var height = $('#' + ctrId).find('#divMessage')[0].scrollHeight;
                //$('#' + ctrId).find('#divMessage').scrollTop(height);

            }

        }

        function AddUser(chatHub, id, name) {

            var userId = $('#hdId').val();

            var code = "";

            if (userId == id) {

                /*            code = $('<div class="loginUser">' + name + "</div>");*/


                code = $("<li class='p-2 border-bottom' id='" + id + "' style='border-bottom: 1px solid #F5F6F7'>" +
                    "<a class='d-flex justify-content-between' style='text-decoration: none;'>" +
                    "<div class='d-flex flex-row'>" +
                    "<div>" +
                    "<img src='/Account/getImagePorNombre?nombre=" + name + "' alt='avatar' class='d-flex align-self-center me-3 rounded' width='60'>" +
                    "<span class='badge bg-success badge-dot'></span>" +
                    "</div>" +
                    "<div class='pt-1'>" +
                    "<p class='fw-bold' style='color: #F5F6F7'>" + name + "</p>" +
                    /*                    "<p class='small text-muted'>Hello, Are you there?</p>" +*/
                    "</div>" +
                    "</div>" +
                    //"<div class='pt-1'>" +
                    //"<p class='small text-muted mb-1'>Just now</p>" +
                    //"<span class='badge bg-danger rounded-pill float-end'>3</span>" +
                    //"</div>" +
                    "</a>" +
                    "</li>");

            }
            else {

                /*            code = $('<a id="' + id + '" class="user" >' + name + '<a>');*/
                code = $("<li class='p-2' id='" + id + "' style='border-bottom: 1px solid #F5F6F7'>" +
                    "<a id='" + id + "' class='d-flex justify-content-between' style='text-decoration: none;'>" +
                    "<div class='d-flex flex-row'>" +
                    "<div>" +
                    "<img src='/Account/getImagePorNombre?nombre=" + name + "' alt='avatar' class='d-flex align-self-center me-3 rounded' width='60'>" +
                    "<span class='badge bg-success badge-dot'></span>" +
                    "</div>" +
                    "<div class='pt-1'>" +
                    "<p class='fw-bold' style='color: #F5F6F7'>" + name + "</p>" +
                    /*"<p class='small text-muted'>Hello, Are you there?</p>" +*/
                    "</div>" +
                    "</div>" +
                    //"<div class='pt-1'>" +
                    //"<p class='small text-muted mb-1'>Just now</p>" +
                    //"<span class='badge bg-danger rounded-pill float-end'>3</span>" +
                    //"</div>" +
                    "</a>" +
                    "</li>");

                $(code).dblclick(function () {

                    var id = $(this).attr('id');
                    if (userId != id)

                        OpenPrivateChatWindow(chatHub, id, name);

                });
            }

            $("#row2").append(code);
            /*        $("#divusers").append(code);*/

        }

        function AddMessage(userName, message) {
            $('#divChatWindow').append('<div class="message"><span class="userName">' + userName + '</span>: ' + message + '</div>');

            var height = $('#divChatWindow')[0].scrollHeight;
            $('#divChatWindow').scrollTop(height);
        }

        function OpenPrivateChatWindow(chatHub, id, userName) {

            var ctrId = 'private_' + id;

            if ($('#' + ctrId).length > 0) return;

            createPrivateChatWindow(chatHub, id, ctrId, userName);

        }

        function createPrivateChatWindow(chatHub, userId, ctrId, userName) {

            if (document.getElementById("contenedor")) {

            } else {
                var div =
                    "<div class='col-md-6 col-lg-7 col-xl-8' id='contenido2'>" +
                    "   <div class='pt-3 pe-3 overflow-auto' id='contenido' style='position: relative; height: 400px'>" +

                    "   </div>" +
                    "      <div class='text-muted d-flex justify-content-start align-items-center pe-3 pt-3 mt-2' id='contenedor'>" +
                    "           <input type='text' class='form-control form-control-lg' name='comentario' id='txtPrivateMessage' placeholder='Escribe algo'/>" +
                    "           <a class='ms-3' id='btnSendMessage' class='submitButton button'><i style='color: #3e5f8a' class='fas fa-paper-plane'></i></a>" +
                    "       </div>" +
                    "</div>";
            }


            //var div = '<div id="' + ctrId + '" class="ui-widget-content draggable" rel="0">' +
            //    '<div class="header">' +
            //    '<div  style="float:right;">' +
            //    '<img id="imgDelete"  style="cursor:pointer;" src="/Images/delete.png"/>' +
            //    '</div>' +

            //    '<span class="selText" rel="0">' + userName + '</span>' +
            //    '</div>' +
            //    '<div id="divMessage" class="messageArea">' +

            //    '</div>' +
            //    '<div class="buttonBar">' +
            //    '<input id="txtPrivateMessage" class="msgText" type="text"   />' +
            //    '<input id="btnSendMessage" class="submitButton button" type="button" value="Send"   />' +
            //    '</div>' +
            //    '</div>';

            var $div = $(div);

            // DELETE BUTTON IMAGE
            $div.find('#imgDelete').click(function () {
                $('#' + ctrId).remove();
            });

            // Send Button event
            $div.find("#btnSendMessage").click(function () {

                $textBox = $div.find("#txtPrivateMessage");
                var msg = $textBox.val();
                if (msg.length > 0) {

                    chatHub.server.sendPrivateMessage(userId, msg);
                    $textBox.val('');
                }
            });

            // Text Box event
            $div.find("#txtPrivateMessage").keypress(function (e) {
                if (e.which == 13) {
                    $div.find("#btnSendMessage").click();
                }
            });

            AddDivToContainer($div);

        }

        function AddDivToContainer($div) {
            $('#row').append($div);



            ////$div.resizable({
            ////    stop: function () {

            ////    }
            ////});

        }


        function listarNombreUsuario() {

            $.ajax({
                type: "GET",
                url: "/Account/listarid_UsuarioPorEmail",
                dataType: "JSON",
                contentType: "application/json; charset=utf-8",
                cache: false,

                success: function (data) {

                    $.ajax({
                        type: "POST",
                        url: "/Account/listarNombre_CompletoPorid_Usuario",
                        traditional: true,
                        data: { "id": data },

                        success: function (data) {
                            $("#name").text(data);
                        },

                        error: function (error) {
                            alert("Ha ocurrido un error: " + error);
                        }
                    });

                },

                error: function (error) {
                    alert("Ha ocurrido un error: " + error);
                }
            });

        }

        function obtenerRolUsuario() {

            $.ajax({
                type: "GET",
                url: "/Account/listarid_UsuarioPorEmail",
                dataType: "JSON",
                contentType: "application/json; charset=utf-8",
                cache: false,

                success: function (data) {

                    $.ajax({
                        type: "POST",
                        url: "/Account/listarid_RolPorid_Usuario",
                        traditional: true,
                        data: { "id": data },

                        success: function (data) {

                            let rol = "";
                            if (data == 1) {
                                rol += "Administrador";
                            } else if (data == 2) {
                                rol += "Usuario";
                            }

                            $("#rol").text(rol);
                        },

                        error: function (error) {
                            alert("Ha ocurrido un error: " + error);
                        }
                    });

                },

                error: function (error) {
                    alert("Ha ocurrido un error: " + error);
                }
            });

        }

        let arrow = document.querySelectorAll(".arrow");
        for (var i = 0; i < arrow.length; i++) {
            arrow[i].addEventListener("click", (e) => {
                let arrowParent = e.target.parentElement.parentElement;//selecting main parent of arrow
                arrowParent.classList.toggle("showMenu");
            });
        }
        let sidebar = document.querySelector(".sidebar");
        let sidebarBtn = document.querySelector(".bx-menu");
        console.log(sidebarBtn);
        sidebarBtn.addEventListener("click", () => {
            sidebar.classList.toggle("close");
        });
    </script>
</body>
</html>